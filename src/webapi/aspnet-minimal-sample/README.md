# ASP.NET Core Minimal API with MySQL - ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç®¡ç†

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€Entity Framework Coreã‚’ä½¿ç”¨ã—ã¦MySQLãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¨ã®é€£æºã‚’è¡Œã„ã¾ã™ã€‚

## å‰ææ¡ä»¶

- .NET 9.0
- MySQL 8.0ä»¥é™
- Entity Framework Core Tools

## ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­å®š

### 1. æ¥ç¶šæ–‡å­—åˆ—ã®è¨­å®š

`appsettings.json`ã¾ãŸã¯`appsettings.Development.json`ã§æ¥ç¶šæ–‡å­—åˆ—ã‚’è¨­å®šã—ã¦ãã ã•ã„ï¼š

```json
{
  "ConnectionStrings": {
    "DefaultConnection": "Server=localhost;Database=mos;User=root;Password=your_password;Port=3306;"
  }
}
```

### 2. ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®ç®¡ç†

#### PowerShellï¼ˆWindowsï¼‰

```powershell
# åˆæœŸãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œæˆ
.\migrate.ps1 init

# æ–°ã—ã„ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œæˆ
.\migrate.ps1 add "AddNewTable"

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’æœ€æ–°ã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã«æ›´æ–°
.\migrate.ps1 update

# ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®çŠ¶æ…‹ã‚’ç¢ºèª
.\migrate.ps1 status

# åˆæœŸãƒ‡ãƒ¼ã‚¿ã‚’æŠ•å…¥
.\migrate.ps1 seed

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ãƒªã‚»ãƒƒãƒˆï¼ˆå±é™ºï¼‰
.\migrate.ps1 reset
```

#### Bashï¼ˆLinux/Macï¼‰

```bash
# åˆæœŸãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œæˆ
./migrate.sh init

# æ–°ã—ã„ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œæˆ
./migrate.sh add "AddNewTable"

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’æœ€æ–°ã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã«æ›´æ–°
./migrate.sh update

# ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®çŠ¶æ…‹ã‚’ç¢ºèª
./migrate.sh status

# åˆæœŸãƒ‡ãƒ¼ã‚¿ã‚’æŠ•å…¥
./migrate.sh seed

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ãƒªã‚»ãƒƒãƒˆï¼ˆå±é™ºï¼‰
./migrate.sh reset
```

#### æ‰‹å‹•ã§ã®Entity Framework Coreã‚³ãƒãƒ³ãƒ‰

```bash
# åˆæœŸãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œæˆ
dotnet ef migrations add InitialCreate

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’æ›´æ–°
dotnet ef database update

# åˆæœŸãƒ‡ãƒ¼ã‚¿ã‚’æŠ•å…¥
dotnet run -- --seed

# ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®çŠ¶æ…‹ã‚’ç¢ºèª
dotnet ef migrations list

# ç‰¹å®šã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã«ç§»è¡Œ
dotnet ef database update TargetMigration

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’å‰Šé™¤
dotnet ef database drop
```

## ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã®æ§‹æˆ

### è‡ªå‹•ç”Ÿæˆã•ã‚Œã‚‹ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

Entity Framework Coreã¯ã€ãƒ¢ãƒ‡ãƒ«ã®å¤‰æ›´ã‚’æ¤œå‡ºã—ã¦è‡ªå‹•çš„ã«ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œæˆã—ã¾ã™ï¼š

- `Migrations/[timestamp]_InitialCreate.cs`: ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®å®Ÿè¡Œå†…å®¹
- `Migrations/[timestamp]_InitialCreate.Designer.cs`: EF Coreã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿
- `Migrations/AppDbContextModelSnapshot.cs`: ç¾åœ¨ã®ãƒ¢ãƒ‡ãƒ«ã®ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆ

### æ‰‹å‹•ã§ã®SQLå®Ÿè¡Œ

æ‰‹å‹•ã§SQLã‚’å®Ÿè¡Œã™ã‚‹å ´åˆã¯ã€`database/init/01_create_tables.sql`ã‚’ä½¿ç”¨ã§ãã¾ã™ï¼š

```sql
-- MySQLã«ç›´æ¥æ¥ç¶šã—ã¦å®Ÿè¡Œ
mysql -u root -p mos < database/init/01_create_tables.sql
```

## åˆæœŸãƒ‡ãƒ¼ã‚¿ã«ã¤ã„ã¦

### è‡ªå‹•æŠ•å…¥ã•ã‚Œã‚‹åˆæœŸãƒ‡ãƒ¼ã‚¿

`Services/DatabaseSeeder.cs`ã§ä»¥ä¸‹ã®ãƒ‡ãƒ¼ã‚¿ãŒè‡ªå‹•æŠ•å…¥ã•ã‚Œã¾ã™ï¼š

- **ã‚«ãƒ†ã‚´ãƒª**: 10ä»¶ï¼ˆä»Šæœˆã®ãŠè–¦ã‚ã€ç‰¹åˆ¥ä¾¡æ ¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã€é™å®šãƒ¡ãƒ‹ãƒ¥ãƒ¼ã€ãƒ¡ã‚¤ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã€ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼ã€ãƒ›ãƒƒãƒˆãƒ‰ãƒƒã‚¯ã€ã‚½ã‚¤ãƒ‘ãƒ†ã‚£ã€ã‚µã‚¤ãƒ‰ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã€ãƒ‰ãƒªãƒ³ã‚¯ãƒ»ã‚¹ãƒ¼ãƒ—ã€ãƒ‡ã‚¶ãƒ¼ãƒˆï¼‰
- **å•†å“**: 25ä»¶ï¼ˆãƒ¢ã‚¹ãƒãƒ¼ã‚¬ãƒ¼é¢¨ã®ãƒ•ã‚¡ã‚¹ãƒˆãƒ•ãƒ¼ãƒ‰å•†å“ï¼‰
- **æ³¨æ–‡**: 3ä»¶ï¼ˆã‚µãƒ³ãƒ—ãƒ«æ³¨æ–‡ãƒ‡ãƒ¼ã‚¿ï¼‰
- **æ³¨æ–‡å•†å“**: é–¢é€£ã™ã‚‹æ³¨æ–‡å•†å“ãƒ‡ãƒ¼ã‚¿

### åˆæœŸãƒ‡ãƒ¼ã‚¿ã®æŠ•å…¥

```bash
# åˆæœŸãƒ‡ãƒ¼ã‚¿ã‚’æŠ•å…¥
dotnet run -- --seed

# ã¾ãŸã¯ PowerShell
.\migrate.ps1 seed

# ã¾ãŸã¯ Bash
./migrate.sh seed
```

## Dockerç’°å¢ƒã§ã®ä½¿ç”¨

### é€šå¸¸ã®Dockerç’°å¢ƒ

Dockerç’°å¢ƒã§ã¯ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®åˆæœŸåŒ–ãŒè‡ªå‹•ã§è¡Œã‚ã‚Œã¾ã™ï¼š

```bash
# é–‹ç™ºç’°å¢ƒã®èµ·å‹•
docker-compose -f docker-compose.dev.yml up

# æœ¬ç•ªç’°å¢ƒã®èµ·å‹•
docker-compose up
```

### VS Code Dev Containerç’°å¢ƒ ğŸš€

**æ¨å¥¨**: å®Œå…¨ã«åˆ†é›¢ã•ã‚ŒãŸé–‹ç™ºç’°å¢ƒã¨ã—ã¦ã€VS Code ã® Dev Container æ©Ÿèƒ½ã‚’ä½¿ç”¨ã§ãã¾ã™ã€‚

```bash
# VS Code ã§é–‹ã
code .

# ã‚³ãƒãƒ³ãƒ‰ãƒ‘ãƒ¬ãƒƒãƒˆ (Ctrl+Shift+P) ã§ä»¥ä¸‹ã‚’é¸æŠ
Remote-Containers: Reopen in Container
```

**å«ã¾ã‚Œã‚‹ã‚µãƒ¼ãƒ“ã‚¹**:
- ASP.NET Core 9.0 é–‹ç™ºç’°å¢ƒ
- MySQL 8.0 ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
- phpMyAdmin ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç®¡ç†ãƒ„ãƒ¼ãƒ«
- Entity Framework Core ãƒ„ãƒ¼ãƒ«
- é–‹ç™ºç”¨ã‚¨ã‚¤ãƒªã‚¢ã‚¹ï¼ˆ`dev`, `migrate`, `seed` ãªã©ï¼‰

**è‡ªå‹•ã§å®Ÿè¡Œã•ã‚Œã‚‹å‡¦ç†**:
- ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®å¾©å…ƒ
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
- åˆæœŸãƒ‡ãƒ¼ã‚¿ã®æŠ•å…¥
- ä¾¿åˆ©ãªã‚¨ã‚¤ãƒªã‚¢ã‚¹ã®è¨­å®š

è©³ç´°ã¯ `.devcontainer/README.md` ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼

```bash
# ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒªã‚»ãƒƒãƒˆ
dotnet ef migrations remove

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’å‰Šé™¤ã—ã¦å†ä½œæˆ
dotnet ef database drop
dotnet ef database update
```

### æ¥ç¶šã‚¨ãƒ©ãƒ¼

1. MySQL ã‚µãƒ¼ãƒãƒ¼ãŒèµ·å‹•ã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
2. æ¥ç¶šæ–‡å­—åˆ—ãŒæ­£ã—ã„ã“ã¨ã‚’ç¢ºèª
3. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ `mos` ãŒå­˜åœ¨ã™ã‚‹ã“ã¨ã‚’ç¢ºèª

### ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚¨ãƒ©ãƒ¼

```bash
# ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’å¾©å…ƒ
dotnet restore

# ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢
dotnet nuget locals all --clear
```

## API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å¾Œã€ä»¥ä¸‹ã®APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãŒåˆ©ç”¨å¯èƒ½ã«ãªã‚Šã¾ã™ï¼š

- `GET /mos/api/categories` - ã‚«ãƒ†ã‚´ãƒªä¸€è¦§
- `GET /mos/api/products` - å•†å“ä¸€è¦§
- `GET /mos/api/orders` - æ³¨æ–‡ä¸€è¦§
- `POST /mos/api/orders` - æ³¨æ–‡ä½œæˆ

è©³ç´°ãªä»•æ§˜ã«ã¤ã„ã¦ã¯ã€`webapi/mos-api.yaml`ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚
